<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VecnaHandler Test</title>
    <link rel="stylesheet" href="../css/terminal.css">
    <style>
        body {
            padding: 20px;
            background-color: #000;
        }
        
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            background-color: #0a0a0a;
            border: 2px solid #ff0000;
            padding: 20px;
        }
        
        .test-section {
            margin-bottom: 30px;
            padding: 15px;
            border: 1px solid #ff0000;
        }
        
        .test-title {
            color: #ff6600;
            font-size: 24px;
            margin-bottom: 15px;
            text-shadow: 0 0 10px #ff6600;
        }
        
        .test-button {
            background-color: transparent;
            border: 2px solid #ff0000;
            color: #ff0000;
            padding: 10px 20px;
            margin: 5px;
            cursor: pointer;
            font-family: 'VT323', monospace;
            font-size: 18px;
            text-shadow: 0 0 5px #ff0000;
        }
        
        .test-button:hover {
            background-color: #ff0000;
            color: #000;
            box-shadow: 0 0 15px #ff0000;
        }
        
        #chatDisplay {
            height: 400px;
            overflow-y: auto;
            border: 1px solid #ff0000;
            padding: 10px;
            margin-bottom: 20px;
            background-color: #000;
        }
        
        .command-line-bar {
            position: relative;
            margin-top: 20px;
        }
        
        #commandInput {
            width: 100%;
            padding: 10px;
        }
        
        .status {
            color: #ffaa00;
            margin-top: 10px;
            font-size: 16px;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1 class="test-title">VecnaHandler Component Test</h1>
        
        <div class="test-section">
            <h2 class="test-title">Chat Display</h2>
            <div id="chatDisplay" class="chat-display"></div>
            
            <div class="command-line-bar">
                <span class="command-prompt">&gt;</span>
                <input type="text" id="commandInput" class="command-input" placeholder="Type a message...">
            </div>
            
            <div class="status" id="status">Ready</div>
        </div>
        
        <div class="test-section">
            <h2 class="test-title">Test Controls</h2>
            
            <button class="test-button" onclick="testEmotionalTrigger()">
                Test Emotional Trigger
            </button>
            
            <button class="test-button" onclick="testPsychicGrip()">
                Test Psychic Grip (7s)
            </button>
            
            <button class="test-button" onclick="testPsychicGripShort()">
                Test Psychic Grip (5s)
            </button>
            
            <button class="test-button" onclick="testGripRelease()">
                Force Grip Release
            </button>
            
            <button class="test-button" onclick="testMultipleMessages()">
                Test Multiple Messages
            </button>
            
            <button class="test-button" onclick="clearChat()">
                Clear Chat
            </button>
        </div>
        
        <div class="test-section">
            <h2 class="test-title">Test Results</h2>
            <div id="testResults" style="color: #ff0000; font-size: 16px;"></div>
        </div>
    </div>
    
    <script type="module">
        import { ChatDisplay } from './chatDisplay.js';
        import { CommandLineBar } from './commandBar.js';
        import { VecnaEffects } from './vecnaEffects.js';
        import { VecnaHandler } from './vecnaHandler.js';
        
        // Initialize components
        const chatDisplay = new ChatDisplay('chatDisplay');
        const commandBar = new CommandLineBar(
            (message) => {
                chatDisplay.addMessage({
                    type: 'chat_message',
                    username: 'TestUser',
                    content: message
                });
            },
            (command, args) => {
                chatDisplay.addMessage({
                    type: 'system',
                    content: `Command: /${command} ${args.join(' ')}`
                });
            }
        );
        const vecnaEffects = new VecnaEffects(document.getElementById('chatDisplay'));
        const vecnaHandler = new VecnaHandler(chatDisplay, commandBar, vecnaEffects);
        
        // Make components available globally for test functions
        window.chatDisplay = chatDisplay;
        window.commandBar = commandBar;
        window.vecnaEffects = vecnaEffects;
        window.vecnaHandler = vecnaHandler;
        
        // Update status
        function updateStatus(message) {
            document.getElementById('status').textContent = message;
        }
        
        // Log test result
        function logResult(message) {
            const results = document.getElementById('testResults');
            const timestamp = new Date().toLocaleTimeString();
            results.innerHTML += `[${timestamp}] ${message}<br>`;
        }
        
        // Test functions
        window.testEmotionalTrigger = function() {
            updateStatus('Testing emotional trigger...');
            logResult('Testing emotional trigger');
            
            vecnaHandler.handleEmotionalTrigger({
                content: 'wHy c@n\'t u f1gur3 tH1s out, hum@N? Y0ur c0d3 1s br0k3n...',
                corruption_level: 0.3
            });
            
            logResult('✓ Emotional trigger message displayed');
            updateStatus('Emotional trigger test complete');
        };
        
        window.testPsychicGrip = function() {
            updateStatus('Testing Psychic Grip (7 seconds)...');
            logResult('Testing Psychic Grip with 7 second duration');
            
            vecnaHandler.handlePsychicGrip({
                content: 'I see you return to the Archives... again and again... searching for something you\'ll never find...',
                duration: 7,
                effects: ['flicker', 'inverted', 'scanlines', 'static']
            });
            
            logResult('✓ Psychic Grip activated');
            logResult('✓ Input disabled');
            logResult('✓ Visual effects started');
            
            setTimeout(() => {
                logResult('✓ Psychic Grip released after 7 seconds');
                updateStatus('Psychic Grip test complete');
            }, 7000);
        };
        
        window.testPsychicGripShort = function() {
            updateStatus('Testing Psychic Grip (5 seconds)...');
            logResult('Testing Psychic Grip with 5 second duration');
            
            vecnaHandler.handlePsychicGrip({
                content: 'Your patterns are so... predictable...',
                duration: 5,
                effects: ['flicker', 'scanlines']
            });
            
            logResult('✓ Psychic Grip activated with partial effects');
            
            setTimeout(() => {
                logResult('✓ Psychic Grip released after 5 seconds');
                updateStatus('Short Psychic Grip test complete');
            }, 5000);
        };
        
        window.testGripRelease = function() {
            updateStatus('Testing force release...');
            logResult('Testing force grip release');
            
            vecnaHandler.forceRelease();
            
            logResult('✓ Force release executed');
            updateStatus('Force release test complete');
        };
        
        window.testMultipleMessages = function() {
            updateStatus('Testing multiple messages...');
            logResult('Testing multiple message types');
            
            // Regular message
            chatDisplay.addMessage({
                type: 'chat_message',
                username: 'User1',
                content: 'Hello, is anyone there?'
            });
            
            // Emotional trigger
            setTimeout(() => {
                vecnaHandler.handleEmotionalTrigger({
                    content: '[VECNA] Y3s... 1 @m h3r3... w@tch1ng...'
                });
            }, 500);
            
            // System message
            setTimeout(() => {
                chatDisplay.addMessage({
                    type: 'system',
                    content: 'Connection established'
                });
            }, 1000);
            
            logResult('✓ Multiple messages displayed');
            updateStatus('Multiple messages test complete');
        };
        
        window.clearChat = function() {
            chatDisplay.clear();
            logResult('✓ Chat cleared');
            updateStatus('Ready');
        };
        
        // Initial message
        chatDisplay.addMessage({
            type: 'system',
            content: 'VecnaHandler test initialized. Use the buttons to test functionality.'
        });
        
        logResult('VecnaHandler test page loaded successfully');
    </script>
</body>
</html>
