<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Instant Answer Functional Test</title>
    <link rel="stylesheet" href="css/terminal.css">
    <style>
        body {
            margin: 0;
            padding: 0;
            background-color: #000000;
            display: flex;
            flex-direction: column;
            height: 100vh;
        }
        
        .test-header {
            padding: 20px;
            background-color: rgba(255, 0, 0, 0.1);
            border-bottom: 2px solid var(--terminal-red);
        }
        
        .test-header h1 {
            color: var(--terminal-red);
            margin: 0 0 10px 0;
            font-size: 24px;
        }
        
        .test-header p {
            color: var(--terminal-white);
            margin: 5px 0;
            font-size: 16px;
        }
        
        .test-controls {
            padding: 15px 20px;
            background-color: rgba(255, 0, 0, 0.05);
            border-bottom: 1px solid var(--terminal-gray);
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .test-button {
            background-color: transparent;
            border: 2px solid var(--terminal-white);
            color: var(--terminal-white);
            padding: 8px 16px;
            cursor: pointer;
            font-family: 'VT323', 'Courier New', monospace;
            font-size: 18px;
            transition: all 0.2s ease;
        }
        
        .test-button:hover {
            background-color: var(--terminal-white);
            color: var(--terminal-bg);
        }
        
        .chat-display {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            background-color: #000000;
        }
    </style>
</head>
<body>
    <div class="test-header">
        <h1>Instant Answer Handler - Functional Test</h1>
        <p>This test demonstrates the InstantAnswerHandler working with ChatDisplay</p>
        <p>Click the buttons below to simulate different instant answer scenarios</p>
    </div>
    
    <div class="test-controls">
        <button class="test-button" onclick="testInstantAnswerWithSources()">Test: Answer with Sources</button>
        <button class="test-button" onclick="testNovelQuestion()">Test: Novel Question</button>
        <button class="test-button" onclick="testLongAnswer()">Test: Long Answer</button>
        <button class="test-button" onclick="testMultipleSources()">Test: Multiple Sources</button>
        <button class="test-button" onclick="testMixedMessages()">Test: Mixed Messages</button>
        <button class="test-button" onclick="clearChat()">Clear Chat</button>
    </div>
    
    <div id="chatDisplay" class="chat-display"></div>
    
    <script type="module">
        import { ChatDisplay } from './js/chatDisplay.js';
        import { InstantAnswerHandler } from './js/instantAnswerHandler.js';
        
        // Initialize components
        const chatDisplay = new ChatDisplay('chatDisplay');
        const instantAnswerHandler = new InstantAnswerHandler(chatDisplay);
        
        // Make them globally accessible for button handlers
        window.chatDisplay = chatDisplay;
        window.instantAnswerHandler = instantAnswerHandler;
        
        // Display initial message
        chatDisplay.addMessage({
            type: 'system',
            content: 'Instant Answer Handler initialized. Click buttons above to test different scenarios.'
        });
        
        // Test functions
        window.testInstantAnswerWithSources = function() {
            // Simulate user question
            chatDisplay.addMessage({
                type: 'chat_message',
                username: 'testuser',
                content: 'How do I implement JWT authentication in FastAPI?',
                timestamp: new Date().toISOString()
            });
            
            // Simulate instant answer
            setTimeout(() => {
                instantAnswerHandler.handleInstantAnswer({
                    content: 'To implement JWT authentication in FastAPI, you\'ll need to install python-jose and passlib. Create a security scheme using OAuth2PasswordBearer, then generate tokens with a secret key. Make sure to hash passwords before storing them.',
                    sources: [
                        {
                            username: 'alice',
                            timestamp: '2025-12-03T14:30:00Z',
                            snippet: 'You can use FastAPI\'s OAuth2PasswordBearer for JWT auth...'
                        },
                        {
                            username: 'bob',
                            timestamp: '2025-12-02T09:15:00Z',
                            snippet: 'Don\'t forget to hash passwords with bcrypt before storing'
                        }
                    ],
                    is_novel: false,
                    timestamp: new Date().toISOString()
                });
            }, 500);
            
            // Simulate public question posting
            setTimeout(() => {
                chatDisplay.addMessage({
                    type: 'chat_message',
                    username: 'testuser',
                    content: 'How do I implement JWT authentication in FastAPI?',
                    timestamp: new Date().toISOString()
                });
            }, 1000);
        };
        
        window.testNovelQuestion = function() {
            chatDisplay.addMessage({
                type: 'chat_message',
                username: 'testuser',
                content: 'What is the best way to implement quantum computing in Python?',
                timestamp: new Date().toISOString()
            });
            
            setTimeout(() => {
                instantAnswerHandler.handleInstantAnswer({
                    content: '',
                    sources: [],
                    is_novel: true,
                    timestamp: new Date().toISOString()
                });
            }, 500);
            
            setTimeout(() => {
                chatDisplay.addMessage({
                    type: 'chat_message',
                    username: 'testuser',
                    content: 'What is the best way to implement quantum computing in Python?',
                    timestamp: new Date().toISOString()
                });
            }, 1000);
        };
        
        window.testLongAnswer = function() {
            chatDisplay.addMessage({
                type: 'chat_message',
                username: 'testuser',
                content: 'How do I build a microservices architecture?',
                timestamp: new Date().toISOString()
            });
            
            setTimeout(() => {
                instantAnswerHandler.handleInstantAnswer({
                    content: 'When building a microservices architecture, there are several key considerations to keep in mind. First, ensure each service has a single responsibility and can be deployed independently. Use API gateways for routing and load balancing. Implement proper service discovery mechanisms like Consul or Eureka. For inter-service communication, consider using message queues like RabbitMQ or Kafka for asynchronous operations, and REST or gRPC for synchronous calls. Don\'t forget about monitoring and logging - use tools like Prometheus and ELK stack.',
                    sources: [
                        {
                            username: 'architect_pro',
                            timestamp: '2025-11-15T09:00:00Z',
                            snippet: 'Single responsibility is crucial for microservices'
                        },
                        {
                            username: 'devops_master',
                            timestamp: '2025-11-14T14:20:00Z',
                            snippet: 'API gateways are essential for managing routing'
                        },
                        {
                            username: 'cloud_expert',
                            timestamp: '2025-11-13T16:45:00Z',
                            snippet: 'Use Kafka for event-driven architecture'
                        }
                    ],
                    is_novel: false,
                    timestamp: new Date().toISOString()
                });
            }, 500);
        };
        
        window.testMultipleSources = function() {
            chatDisplay.addMessage({
                type: 'chat_message',
                username: 'testuser',
                content: 'What are the best practices for async Python?',
                timestamp: new Date().toISOString()
            });
            
            setTimeout(() => {
                instantAnswerHandler.handleInstantAnswer({
                    content: 'For async Python, use asyncio for I/O-bound operations, avoid blocking calls in async functions, use connection pools for databases, and handle exceptions properly with try/except blocks. Consider using aiohttp for HTTP requests and asyncpg for PostgreSQL.',
                    sources: [
                        {
                            username: 'python_expert',
                            timestamp: '2025-12-01T10:00:00Z',
                            snippet: 'Always use asyncio.gather() for concurrent operations'
                        },
                        {
                            username: 'backend_dev',
                            timestamp: '2025-11-30T15:30:00Z',
                            snippet: 'Connection pools are essential for async database queries'
                        },
                        {
                            username: 'senior_engineer',
                            timestamp: '2025-11-29T11:20:00Z',
                            snippet: 'Never use time.sleep() in async code, use asyncio.sleep()'
                        },
                        {
                            username: 'tech_lead',
                            timestamp: '2025-11-28T09:45:00Z',
                            snippet: 'aiohttp is the standard for async HTTP requests'
                        },
                        {
                            username: 'db_specialist',
                            timestamp: '2025-11-27T14:10:00Z',
                            snippet: 'asyncpg is much faster than psycopg2 for async PostgreSQL'
                        }
                    ],
                    is_novel: false,
                    timestamp: new Date().toISOString()
                });
            }, 500);
        };
        
        window.testMixedMessages = function() {
            // Regular message
            chatDisplay.addMessage({
                type: 'chat_message',
                username: 'alice',
                content: 'Hey everyone, how\'s it going?',
                timestamp: new Date().toISOString()
            });
            
            setTimeout(() => {
                // System message
                chatDisplay.addMessage({
                    type: 'system',
                    content: 'bob joined the room',
                    timestamp: new Date().toISOString()
                });
            }, 500);
            
            setTimeout(() => {
                // User question
                chatDisplay.addMessage({
                    type: 'chat_message',
                    username: 'bob',
                    content: 'How do I use async/await in JavaScript?',
                    timestamp: new Date().toISOString()
                });
            }, 1000);
            
            setTimeout(() => {
                // Instant answer
                instantAnswerHandler.handleInstantAnswer({
                    content: 'Async/await in JavaScript allows you to write asynchronous code that looks synchronous. Use the async keyword before a function to make it return a Promise, and use await inside to pause execution until a Promise resolves.',
                    sources: [
                        {
                            username: 'js_guru',
                            timestamp: '2025-12-04T10:30:00Z',
                            snippet: 'async/await is syntactic sugar over Promises'
                        }
                    ],
                    is_novel: false,
                    timestamp: new Date().toISOString()
                });
            }, 1500);
            
            setTimeout(() => {
                // Public question
                chatDisplay.addMessage({
                    type: 'chat_message',
                    username: 'bob',
                    content: 'How do I use async/await in JavaScript?',
                    timestamp: new Date().toISOString()
                });
            }, 2000);
            
            setTimeout(() => {
                // Another user responds
                chatDisplay.addMessage({
                    type: 'chat_message',
                    username: 'alice',
                    content: 'Great question! The instant answer covered it well, but I can also share some examples if you need.',
                    timestamp: new Date().toISOString()
                });
            }, 2500);
        };
        
        window.clearChat = function() {
            chatDisplay.clear();
            chatDisplay.addMessage({
                type: 'system',
                content: 'Chat cleared. Ready for new tests.'
            });
        };
    </script>
</body>
</html>
